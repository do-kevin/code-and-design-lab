<section class="embla">
  <div id="stepper">
    <button class="step"></button>
    <button class="step"></button>
    <button class="step"></button>
    <button class="step"></button>
    <button class="step"></button>
  </div>

  <div class="embla__viewport">
    <div class="embla__container">
      <div class="embla__slide">
        <div class="embla__slide__number">Step 1</div>
      </div>
      <div class="embla__slide">
        <div class="embla__slide__number">Step 2</div>
      </div>
      <div class="embla__slide">
        <div class="embla__slide__number">Step 3</div>
      </div>
      <div class="embla__slide">
        <div class="embla__slide__number">Step 4</div>
      </div>
      <div class="embla__slide">
        <div class="embla__slide__number">Step 5</div>
      </div>
    </div>
  </div>

  <div class="embla__controls">
    <div class="embla__buttons">
      <button class="embla__button embla__button--prev" type="button">
        <svg class="embla__button__svg" viewBox="0 0 532 532">
          <path
            fill="currentColor"
            d="M355.66 11.354c13.793-13.805 36.208-13.805 50.001 0 13.785 13.804 13.785 36.238 0 50.034L201.22 266l204.442 204.61c13.785 13.805 13.785 36.239 0 50.044-13.793 13.796-36.208 13.796-50.002 0a5994246.277 5994246.277 0 0 0-229.332-229.454 35.065 35.065 0 0 1-10.326-25.126c0-9.2 3.393-18.26 10.326-25.2C172.192 194.973 332.731 34.31 355.66 11.354Z"
          ></path>
        </svg>
      </button>

      <button class="embla__button embla__button--next" type="button">
        <svg class="embla__button__svg" viewBox="0 0 532 532">
          <path
            fill="currentColor"
            d="M176.34 520.646c-13.793 13.805-36.208 13.805-50.001 0-13.785-13.804-13.785-36.238 0-50.034L330.78 266 126.34 61.391c-13.785-13.805-13.785-36.239 0-50.044 13.793-13.796 36.208-13.796 50.002 0 22.928 22.947 206.395 206.507 229.332 229.454a35.065 35.065 0 0 1 10.326 25.126c0 9.2-3.393 18.26-10.326 25.2-45.865 45.901-206.404 206.564-229.332 229.52Z"
          ></path>
        </svg>
      </button>
    </div>
  </div>
</section>
<style>
  html {
    background-color: #f2f2f2;
    --detail-high-contrast: rgb(192, 192, 192);
    --detail-medium-contrast: rgb(234, 234, 234);
    --text-high-contrast-rgb-value: 49, 49, 49;

    --slide-height: 32rem;
    --slide-spacing: 1rem;
    --slide-size: 100%;
  }

  .embla {
    max-width: 22rem;
    margin: auto;
    position: relative;
  }
  .embla__viewport {
    overflow: hidden;
    border: 2px solid rgb(234, 234, 234);
    border-radius: 1.8rem;
    background: rgb(217, 183, 255);
  }
  .embla__container {
    backface-visibility: hidden;
    display: flex;
    touch-action: pan-y pinch-zoom;
    background: rgb(217, 183, 255);
    /* margin-left: calc(var(--slide-spacing) * -1); */
    position: relative;
    height: var(--slide-height);
  }
  .embla__slide {
    flex: 0 0 var(--slide-size);
    min-width: 0;
    /* padding-left: var(--slide-spacing); */
    opacity: 0;
    transition: all 1.2s ease-in-out;
    position: absolute;
    width: 100%;
  }
  .embla__slide__number {
    background: rgb(74, 175, 237);
    font-size: 4rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    height: var(--slide-height);
    width: 100%;
  }
  .embla__controls {
    display: grid;
    grid-template-columns: auto 1fr;
    justify-content: space-between;
    gap: 1.2rem;
    margin-top: 1.8rem;
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
  }
  .embla__buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.6rem;
    align-items: center;
  }
  .embla__button {
    -webkit-tap-highlight-color: rgba(var(--text-high-contrast-rgb-value), 0.5);
    -webkit-appearance: none;
    appearance: none;
    background-color: transparent;
    touch-action: manipulation;
    display: inline-flex;
    text-decoration: none;
    cursor: pointer;
    border: 0;
    padding: 0;
    margin: 0;
    box-shadow: inset 0 0 0 0.2rem var(--detail-medium-contrast);
    width: 3.6rem;
    height: 3.6rem;
    z-index: 1;
    border-radius: 50%;
    color: var(--text-body);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .embla__button:disabled {
    color: var(--detail-high-contrast);
  }
  .embla__button__svg {
    width: 35%;
    height: 35%;
  }

  #stepper {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  #stepper .step {
    border: 2px solid var(--detail-high-contrast);
    padding: 0.5rem;
    border-radius: 50%;
    background-color: #fff;
    cursor: pointer;
  }

  .step.step--is-active {
    background-color: rgb(103, 195, 244) !important;
  }

  .embla__slide.is-active {
    opacity: 1;
  }
  .embla__button--prev:disabled {
    opacity: 0;
  }
</style>
<script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>
<script>
  const OPTIONS = {
    loop: false,
    containScroll: false,
    speed: 0,
  };
  const emblaNode = document.querySelector(".embla");
  const viewportNode = emblaNode?.querySelector(".embla__viewport");
  const prevBtnNode = emblaNode?.querySelector(".embla__button--prev");
  const nextBtnNode = emblaNode?.querySelector(".embla__button--next");
  const dotsNode = emblaNode?.querySelector(".embla__dots");
  const slides = emblaNode.querySelectorAll(".embla__slide");

  const emblaApi = EmblaCarousel(viewportNode, OPTIONS);

  const addTogglePrevNextBtnsActive = (emblaApi, prevBtn, nextBtn) => {
    const togglePrevNextBtnsState = () => {
      if (emblaApi.canScrollPrev()) prevBtn.removeAttribute("disabled");
      else prevBtn.setAttribute("disabled", "disabled");

      if (emblaApi.canScrollNext()) nextBtn.removeAttribute("disabled");
      else nextBtn.removeAttribute("disabled");
    };

    emblaApi
      .on("select", togglePrevNextBtnsState)
      .on("init", togglePrevNextBtnsState)
      .on("reInit", togglePrevNextBtnsState);

    return () => {
      prevBtn.removeAttribute("disabled");
      nextBtn.removeAttribute("disabled");
    };
  };

  const addPrevNextBtnsClickHandlers = (emblaApi, prevBtn, nextBtn) => {
    const scrollPrev = () => {
      emblaApi.scrollPrev();
    };
    const scrollNext = () => {
      emblaApi.scrollNext();
    };
    prevBtn.addEventListener("click", scrollPrev, false);
    nextBtn.addEventListener("click", scrollNext, false);

    const removeTogglePrevNextBtnsActive = addTogglePrevNextBtnsActive(
      emblaApi,
      prevBtn,
      nextBtn,
    );

    return () => {
      removeTogglePrevNextBtnsActive();
      prevBtn.removeEventListener("click", scrollPrev, false);
      nextBtn.removeEventListener("click", scrollNext, false);
    };
  };

  const removePrevNextBtnsClickHandlers = addPrevNextBtnsClickHandlers(
    emblaApi,
    prevBtnNode,
    nextBtnNode,
  );

  const updateActiveSlide = () => {
    const selectedIndex = emblaApi.selectedScrollSnap();
    slides.forEach((slide, index) => {
      if (index === selectedIndex) {
        slide.classList.add("is-active");
      } else {
        slide.classList.remove("is-active");
      }
    });
  };

  emblaApi.on("select", updateActiveSlide);
  emblaApi.on("init", updateActiveSlide);
  emblaApi.on("reInit", updateActiveSlide);

  const stepper = document.querySelector("#stepper");

  stepper.querySelectorAll(".step").forEach((step, index) => {
    step.addEventListener("click", function () {
      stepper
        .querySelectorAll(".step")
        .forEach((_s) => _s.classList.remove("step--is-active"));
      step.classList.add("step--is-active");
      emblaApi.scrollTo(index);
    });
  });

  // const test = emblaApi.scrollSnapList();
  // const test2 = emblaApi.selectedScrollSnap();

  // console.log("test: ", test);
  // console.log("test2: ", test2);

  // const slidesInSnap = emblaApi.internalEngine().slideRegistry[2];
  // const { scrollSnaps, containerRect } = emblaApi.internalEngine();

  // console.log(containerRect.width * 2);

  // function getSlideTransform(position) {
  //   const { axis } = emblaApi.internalEngine();
  //   const translateAxis = axis.scroll.toUpperCase();
  //   return `translate${translateAxis}(${axis.direction(position)}px)`;
  // }

  // emblaApi.slideNodes()[2].style.transform = getSlideTransform(
  //   containerRect.width * 2,
  // );

  emblaApi.on("destroy", removePrevNextBtnsClickHandlers);
</script>
